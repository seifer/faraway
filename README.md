# Word of Wisdom TCP-сервер с защитой от DDoS

Этот проект представляет собой TCP-сервер "Word of Wisdom", который защищен от DDoS-атак с помощью механизма Proof of Work (PoW). После успешной верификации PoW сервер отправляет клиенту случайную цитату из коллекции мудрых высказываний.

## Содержание

- [Архитектура](#архитектура)
- [Proof of Work алгоритм](#proof-of-work-алгоритм)
- [Протокол взаимодействия](#протокол-взаимодействия)
- [Как запустить](#как-запустить)
- [Конфигурация](#конфигурация)
- [Тестирование](#тестирование)

## Архитектура

Проект состоит из следующих компонентов:

1. **TCP-сервер**: принимает соединения, отправляет задачи Proof of Work, проверяет решения и отправляет цитаты.
2. **Клиент**: подключается к серверу, решает задачу PoW и получает цитату.
3. **Shared**: содержит общий код для работы с алгоритмом Proof of Work.
4. **Quotes**: содержит коллекцию цитат.

Все компоненты реализованы на языке Go и упакованы в Docker-контейнеры.

## Proof of Work алгоритм

Для защиты от DDoS-атак используется алгоритм Proof of Work, основанный на принципах Hashcash. Этот алгоритм был выбран по следующим причинам:

1. **Асимметричность**: задача легко проверяется сервером, но требует вычислительных ресурсов от клиента.
2. **Настраиваемая сложность**: можно регулировать уровень сложности в зависимости от нагрузки на сервер.
3. **Простота реализации**: алгоритм относительно прост для понимания и реализации.
4. **Эффективность**: проверка решения выполняется очень быстро, что минимизирует нагрузку на сервер.

### Как работает PoW:

1. Сервер генерирует случайный префикс и указывает требуемую сложность (количество нулевых бит в начале хеша).
2. Клиент должен найти такое число (nonce), чтобы SHA-256 хеш от комбинации префикса и этого числа имел указанное количество нулевых бит в начале.
3. Клиент отправляет найденное значение nonce серверу.
4. Сервер проверяет решение и, если оно верно, отправляет цитату.

Сложность задачи (количество начальных нулевых бит) можно настраивать в зависимости от требуемого уровня защиты. Например, сложность 20 бит означает, что в среднем клиенту потребуется выполнить 2^20 операций хеширования для решения задачи.

## Протокол взаимодействия

Протокол общения между сервером и клиентом следующий:

1. **Клиент подключается к серверу**.
2. **Сервер отправляет задачу**:
   ```
   CHALLENGE <prefix>:<difficulty>
   ```
3. **Клиент решает задачу и отправляет решение**:
   ```
   SOLUTION <prefix>:<difficulty>:<nonce>
   ```
4. **Сервер проверяет решение**:
   - Если решение верно, отправляет цитату:
     ```
     QUOTE <цитата>
     ```
   - Если решение неверно, отправляет ошибку:
     ```
     ERROR: <причина ошибки>
     ```

## Как запустить

### С использованием Docker Compose

Самый простой способ запустить сервер и клиент:

```bash
docker-compose up
```

Это запустит сервер и клиент в отдельных контейнерах. Клиент подключится к серверу, решит задачу PoW и получит цитату.

### Запуск только сервера

```bash
docker-compose up server
```

### Запуск клиента отдельно

```bash
docker-compose up client
```

### Сборка и запуск без Docker

Для сборки и запуска без Docker:

**Сервер**:
```bash
go build -o server ./server/cmd
./server
```

**Клиент**:
```bash
go build -o client ./client/cmd
./client
```

## Конфигурация

### Конфигурация сервера

Конфигурация сервера может быть изменена через переменные окружения:

- `SERVER_HOST`: хост для привязки сервера (по умолчанию `0.0.0.0`)
- `SERVER_PORT`: порт для прослушивания (по умолчанию `8080`)
- `POW_DIFFICULTY`: сложность Proof of Work (по умолчанию `20`)
- `READ_TIMEOUT`: таймаут чтения в секундах (по умолчанию `10`)
- `WRITE_TIMEOUT`: таймаут записи в секундах (по умолчанию `10`)

### Конфигурация клиента

Конфигурация клиента может быть изменена через переменные окружения:

- `SERVER_HOST`: хост сервера (по умолчанию `localhost`)
- `SERVER_PORT`: порт сервера (по умолчанию `8080`)
- `CONNECT_TIMEOUT`: таймаут подключения в секундах (по умолчанию `5`)
- `RESPONSE_TIMEOUT`: таймаут ожидания ответа в секундах (по умолчанию `30`)

## Тестирование

Для тестирования защиты от DDoS можно выполнить множество одновременных запросов к серверу. Например, используя инструмент `siege` или `ab`:

```bash
siege -c 50 -r 10 http://localhost:8080
```

Это создаст 50 одновременных подключений, каждое из которых выполнит 10 запросов. Сервер должен успешно обработать все запросы, заставляя клиентов решать задачу PoW перед отправкой цитаты. 